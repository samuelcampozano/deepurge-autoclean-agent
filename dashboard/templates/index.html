<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deepurge Dashboard â€“ Walrus Blob Viewer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
</head>
<body>

<!-- Overlay for closing sidebar -->
<div class="sidebar-overlay" id="overlay"></div>

<!-- â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
        <button class="sidebar-close" id="sidebarClose" title="Close menu">âœ•</button>
        <span class="brand-icon">ğŸ¤–</span>
        <h1>Deepurge</h1>
        <span class="brand-sub">AutoClean Agent</span>
    </div>

    <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-view="control">
            <span class="nav-icon">ğŸ®</span> Control Panel
        </a>
        <a href="#" class="nav-item" data-view="dashboard">
            <span class="nav-icon">ğŸ“Š</span> Dashboard
        </a>
        <a href="#" class="nav-item" data-view="explorer">
            <span class="nav-icon">ğŸ”</span> Blob Explorer
        </a>
        <a href="#" class="nav-item" data-view="history">
            <span class="nav-icon">ğŸ“œ</span> Upload History
        </a>
        <a href="#" class="nav-item" data-view="live">
            <span class="nav-icon">âš¡</span> Live Feed
        </a>
        <a href="#" class="nav-item" data-view="vault">
            <span class="nav-icon">ğŸ”</span> Vault
        </a>
        <a href="#" class="nav-item" data-view="workflows">
            <span class="nav-icon">âš™ï¸</span> Workflows
        </a>
        <a href="#" class="nav-item" data-view="anchors">
            <span class="nav-icon">âš“</span> Sui Anchor
        </a>
    </nav>

    <div class="sidebar-footer">
        <div class="walrus-badge">
            <span>ğŸ¦­</span> Walrus Testnet
        </div>
        <p class="credit">x OpenClaw Agent Hackathon</p>
    </div>
</aside>

<!-- â”€â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main class="main" id="main">

    <!-- Header -->
    <header class="topbar">
        <button class="menu-toggle" id="menuToggle">â˜°</button>
        <div class="topbar-title">
            <h2 id="viewTitle">ğŸ® Control Panel</h2>
        </div>
        <div class="topbar-actions">
            <span class="agent-indicator" id="agentIndicator">
                <span class="indicator-dot" id="indicatorDot"></span>
                <span id="indicatorText">Agent Stopped</span>
            </span>
            <button class="btn btn-sm btn-outline" id="refreshBtn" title="Refresh data">ğŸ”„ Refresh</button>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Control Panel â•â•â•â•â•â•â•â•â• -->
    <section class="view active" id="view-control">

        <!-- Agent status card -->
        <div class="panel full-width agent-status-panel" id="agentStatusPanel">
            <div class="agent-status-row">
                <div class="agent-status-info">
                    <h3 class="panel-title">ğŸ¤– Agent Status</h3>
                    <p class="agent-status-text" id="agentStatusText">Agent is <strong>stopped</strong></p>
                    <p class="agent-pid" id="agentPidText"></p>
                </div>
                <div class="agent-status-actions">
                    <button class="btn btn-success" id="btnStartAgent">â–¶ Start Agent</button>
                    <button class="btn btn-danger" id="btnStopAgent" disabled>â¹ Stop Agent</button>
                </div>
            </div>
        </div>

        <!-- Demo generator -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ¬ Demo File Generator</h3>
            <p class="panel-desc">Create test files in your Downloads folder so the agent has something to organize and upload to Walrus.</p>
            <div class="demo-controls">
                <label class="demo-label">Number of files:</label>
                <input type="number" id="demoCount" class="input input-sm" value="50" min="1" max="500" />
                <button class="btn btn-primary" id="btnGenerateDemo">ğŸ“¦ Generate Demo Files</button>
            </div>
        </div>

        <!-- Live Console -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“Ÿ Console Output</h3>
            <p class="panel-desc">Real-time output from the agent and demo generator.</p>
            <div class="console" id="consoleOutput">
                <div class="console-line sys">[SYS] Dashboard ready. Start the agent to begin.</div>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Dashboard â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-dashboard">

        <!-- Stat Cards -->
        <div class="stat-grid">
            <div class="stat-card accent-blue">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-body">
                    <span class="stat-value" id="statFiles">â€“</span>
                    <span class="stat-label">Files Processed</span>
                </div>
            </div>
            <div class="stat-card accent-purple">
                <div class="stat-icon">ğŸ¦­</div>
                <div class="stat-body">
                    <span class="stat-value" id="statUploads">â€“</span>
                    <span class="stat-label">Walrus Uploads</span>
                </div>
            </div>
            <div class="stat-card accent-green">
                <div class="stat-icon">ğŸ’¾</div>
                <div class="stat-body">
                    <span class="stat-value" id="statSize">â€“</span>
                    <span class="stat-label">Data Processed</span>
                </div>
            </div>
            <div class="stat-card accent-orange">
                <div class="stat-icon">ğŸ“‚</div>
                <div class="stat-body">
                    <span class="stat-value" id="statCategories">â€“</span>
                    <span class="stat-label">Categories</span>
                </div>
            </div>
        </div>

        <!-- Insights Card -->
        <div class="panel full-width insights-panel" id="insightsPanel">
            <h3 class="panel-title">ğŸ’¡ Smart Insights</h3>
            <p class="panel-desc">Data-driven metrics calculated from your actual usage. Time saved is based on an average of <strong>30 seconds per file</strong> for manual sorting (locating, categorising, renaming, and moving).</p>
            <div class="insights-grid">
                <div class="insight-card">
                    <span class="insight-icon">â±ï¸</span>
                    <span class="insight-value" id="insightTimeSaved">â€“</span>
                    <span class="insight-label">Time Saved</span>
                </div>
                <div class="insight-card">
                    <span class="insight-icon">ğŸ†</span>
                    <span class="insight-value" id="insightTopCat">â€“</span>
                    <span class="insight-label">Top Category</span>
                </div>
                <div class="insight-card">
                    <span class="insight-icon">ğŸš«</span>
                    <span class="insight-value" id="insightDuplicates">â€“</span>
                    <span class="insight-label">Duplicates Prevented</span>
                </div>
                <div class="insight-card">
                    <span class="insight-icon">ğŸ”—</span>
                    <span class="insight-value" id="insightBlobs">â€“</span>
                    <span class="insight-label">Blobs on Walrus</span>
                </div>
            </div>
        </div>

        <!-- Charts row -->
        <div class="panel-grid">
            <div class="panel">
                <h3 class="panel-title">ğŸ“Š Category Breakdown</h3>
                <div class="chart-container" id="categoryChart"></div>
            </div>
            <div class="panel">
                <h3 class="panel-title">âš¡ Recent Activity</h3>
                <div class="activity-list" id="recentActivity"></div>
            </div>
        </div>

        <!-- Walrus uploads table -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ¦­ Recent Walrus Uploads</h3>
            <div class="table-wrap">
                <table class="data-table" id="uploadsTable">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Content Type</th>
                            <th>Actions</th>
                            <th>Blob ID</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Walrus Blockchain Status -->
        <div class="panel full-width walrus-chain-panel">
            <h3 class="panel-title">ğŸ”— Walrus Blockchain Status</h3>
            <p class="panel-desc">Immutable, decentralized storage powered by the Sui blockchain. Every file action is cryptographically verified and permanently recorded.</p>
            <div class="chain-metrics">
                <div class="chain-metric">
                    <span class="chain-value" id="chainTotalBlobs">â€“</span>
                    <span class="chain-label">Total Blobs Stored</span>
                </div>
                <div class="chain-metric">
                    <span class="chain-value" id="chainStorage">â€“</span>
                    <span class="chain-label">On-Chain Storage</span>
                </div>
                <div class="chain-metric">
                    <span class="chain-value" id="chainOldest">â€“</span>
                    <span class="chain-label">Oldest Record</span>
                </div>
                <div class="chain-metric">
                    <span class="chain-value" id="chainNewest">â€“</span>
                    <span class="chain-label">Latest Record</span>
                </div>
                <div class="chain-metric">
                    <span class="chain-value chain-verified">âœ… Verified</span>
                    <span class="chain-label">Blockchain Status</span>
                </div>
                <div class="chain-metric">
                    <span class="chain-value">Testnet</span>
                    <span class="chain-label">Sui Network</span>
                </div>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Blob Explorer â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-explorer">
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ” Walrus Blob Explorer</h3>
            <p class="panel-desc">Enter a Blob ID or full aggregator URL to fetch and visualize the data stored on Walrus.</p>

            <div class="blob-input-row">
                <input type="text" id="blobInput" class="input" placeholder="Paste Blob ID or full URLâ€¦"
                       value="" />
                <button class="btn btn-primary" id="fetchBlobBtn">Fetch Blob</button>
            </div>
        </div>

        <!-- Blob result -->
        <div class="panel full-width hidden" id="blobResultPanel">
            <div class="blob-header">
                <h3 class="panel-title" id="blobResultTitle">Blob Data</h3>
                <div class="blob-meta" id="blobMeta"></div>
            </div>

            <!-- Stats strip for batch blobs -->
            <div class="stat-grid small hidden" id="blobStatStrip"></div>

            <!-- Blob actions table -->
            <div class="table-wrap hidden" id="blobTableWrap">
                <table class="data-table" id="blobTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Timestamp</th>
                            <th>Action</th>
                            <th>File</th>
                            <th>Category</th>
                            <th>Size</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Raw JSON toggle -->
            <details class="raw-toggle">
                <summary>View Raw JSON</summary>
                <pre class="raw-json" id="blobRawJson"></pre>
            </details>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: History â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-history">
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“œ All Walrus Upload History</h3>
            <p class="panel-desc">Every batch, report and session summary that the agent has uploaded. Click a row to explore the blob.</p>
            <div class="table-wrap">
                <table class="data-table" id="historyTable">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Type</th>
                            <th>Actions</th>
                            <th>Blob ID</th>
                            <th>Explore</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Live Feed â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-live">
        <div class="panel full-width">
            <h3 class="panel-title">âš¡ Live Action Feed</h3>
            <p class="panel-desc">Auto-refreshes every 10 seconds from the local database.</p>
            <div class="live-controls">
                <button class="btn btn-sm btn-primary" id="liveToggle">â–¶ Start Live</button>
                <span class="live-status" id="liveStatus">Paused</span>
            </div>
            <div class="activity-list large" id="liveFeed"></div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Vault (Path 2) â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-vault">

        <!-- Upload to Vault -->
        <div class="panel full-width vault-panel">
            <h3 class="panel-title">ğŸ” Deepurge Vault â€” Encrypted Walrus Storage</h3>
            <p class="panel-desc">
                Upload files with <strong>AES-256-GCM</strong> client-side encryption.
                Only you hold the decryption key â€” Walrus stores encrypted ciphertext only.
            </p>

            <div class="vault-upload-area">
                <div class="vault-dropzone" id="vaultDropzone">
                    <span class="vault-drop-icon">ğŸ“¤</span>
                    <p>Drag & drop a file here or <label for="vaultFileInput" class="vault-browse">browse</label></p>
                    <input type="file" id="vaultFileInput" style="display:none" />
                    <span class="vault-drop-hint">File will be encrypted before leaving your machine</span>
                </div>
                <button class="btn btn-primary" id="btnVaultUpload" disabled>ğŸ”’ Encrypt & Upload to Walrus</button>
            </div>

            <!-- Upload result -->
            <div class="vault-result hidden" id="vaultResult">
                <h4>âœ… File Stored in Vault</h4>
                <div class="vault-result-grid">
                    <div class="vault-field"><span class="vault-label">Blob ID</span><span class="vault-value mono" id="vaultBlobId">â€“</span></div>
                    <div class="vault-field"><span class="vault-label">SHA-256</span><span class="vault-value mono" id="vaultSha256">â€“</span></div>
                    <div class="vault-field"><span class="vault-label">Encrypted Size</span><span class="vault-value" id="vaultEncSize">â€“</span></div>
                    <div class="vault-field"><span class="vault-label">ğŸ”‘ Key (keep secret!)</span><span class="vault-value mono key-blur" id="vaultKeyHex">â€“</span></div>
                </div>
                <div class="vault-share-row">
                    <span class="vault-label">ğŸ”— Share Link</span>
                    <input type="text" class="input" id="vaultShareLink" readonly />
                    <button class="btn btn-sm btn-outline" id="btnCopyShareLink">ğŸ“‹ Copy</button>
                </div>
            </div>
        </div>

        <!-- Folder Sync -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“ Folder Sync to Walrus</h3>
            <p class="panel-desc">Sync an entire folder â€” every file is encrypted with a single key and uploaded.</p>
            <div class="vault-folder-row">
                <input type="text" class="input" id="vaultFolderPath" placeholder="Enter folder path (e.g. C:\Users\you\Documents\Contracts)" />
                <button class="btn btn-primary" id="btnVaultSyncFolder">ğŸ”„ Sync Folder</button>
            </div>
            <div class="vault-folder-result hidden" id="vaultFolderResult">
                <p class="vault-folder-summary" id="vaultFolderSummary"></p>
            </div>
        </div>

        <!-- Vault Files List -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ—„ï¸ Vault Files</h3>
            <div class="table-wrap">
                <table class="data-table" id="vaultFilesTable">
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>File</th>
                            <th>Size</th>
                            <th>Blob ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Decrypt / Download -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“¥ Decrypt & Download</h3>
            <p class="panel-desc">Paste a share link or manually enter blob ID + key to retrieve and decrypt a file.</p>
            <div class="vault-decrypt-row">
                <input type="text" class="input" id="vaultDecryptInput" placeholder="Paste share link or blob ID" />
                <input type="text" class="input" id="vaultDecryptKey" placeholder="Decryption Key (hex)" />
                <button class="btn btn-primary" id="btnVaultDecrypt">ğŸ“¥ Decrypt & Download</button>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Workflows (Path 3) â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-workflows">

        <div class="panel full-width workflows-panel">
            <h3 class="panel-title">âš™ï¸ Automation Workflows</h3>
            <p class="panel-desc">
                Define IFâ†’THEN rules: when a file's content matches a pattern, the agent automatically
                moves, converts, or backs it up to Walrus.  OCR is used for PDFs and images.
            </p>

            <!-- Rules List -->
            <div class="wf-rules-list" id="wfRulesList"></div>

            <!-- Add Rule Form -->
            <details class="wf-add-rule-details">
                <summary class="btn btn-sm btn-outline">â• Add New Rule</summary>
                <div class="wf-add-rule-form">
                    <div class="wf-form-row">
                        <label>Rule Name</label>
                        <input type="text" class="input input-sm" id="wfRuleName" placeholder="e.g. Tax Documents" />
                    </div>
                    <div class="wf-form-row">
                        <label>Trigger Type</label>
                        <select class="input input-sm" id="wfTriggerType">
                            <option value="content_match">Content Match (OCR)</option>
                            <option value="extension_match">Extension Match</option>
                            <option value="filename_match">Filename Match</option>
                        </select>
                    </div>
                    <div class="wf-form-row">
                        <label>Trigger Value (regex or extensions)</label>
                        <input type="text" class="input input-sm" id="wfTriggerValue" placeholder="e.g. total\s*due|invoice" />
                    </div>
                    <div class="wf-form-row">
                        <label>Actions (comma-separated: move:FolderName, tag:value, walrus_backup, unzip, convert_to_pdf)</label>
                        <input type="text" class="input input-sm" id="wfActions" placeholder="e.g. move:Taxes, walrus_backup" />
                    </div>
                    <button class="btn btn-primary btn-sm" id="btnWfAddRule">âœ… Save Rule</button>
                </div>
            </details>
        </div>

        <!-- Execution Log -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“‹ Workflow Execution Log</h3>
            <div class="activity-list large" id="wfExecutionLog"></div>
        </div>

        <!-- File Conversion Tools -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ”„ Quick Conversion Tools</h3>
            <p class="panel-desc">Manual one-off file conversions.</p>
            <div class="conversion-grid">
                <div class="conversion-card">
                    <span class="conversion-icon">ğŸ“¸â†’ğŸ“„</span>
                    <h4>Image to PDF</h4>
                    <p>Convert PNG/JPG screenshots to PDF</p>
                    <p class="panel-desc">Handled automatically by the agent when the Screenshot to PDF rule is enabled.</p>
                </div>
                <div class="conversion-card">
                    <span class="conversion-icon">ğŸ“¦â†’ğŸ“‚</span>
                    <h4>Auto-Unzip</h4>
                    <p>ZIP archives are extracted automatically</p>
                    <p class="panel-desc">Enable the "Auto-Unzip Archives" rule above to activate.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â• VIEW: Sui Anchor (Path 3) â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="view" id="view-anchors">

        <div class="panel full-width anchor-panel">
            <h3 class="panel-title">âš“ Sui On-Chain Anchor</h3>
            <p class="panel-desc">
                Each daily report's <strong>root hash</strong> (SHA-256) is anchored on the Sui blockchain.
                This proves your file management logs haven't been tampered with â€” anyone can verify.
            </p>

            <div class="anchor-status-row">
                <div class="anchor-metric">
                    <span class="anchor-value" id="anchorCount">â€“</span>
                    <span class="anchor-label">Reports Anchored</span>
                </div>
                <div class="anchor-metric">
                    <span class="anchor-value" id="anchorLatestDate">â€“</span>
                    <span class="anchor-label">Latest Anchor</span>
                </div>
                <div class="anchor-metric">
                    <span class="anchor-value" id="anchorSource">â€“</span>
                    <span class="anchor-label">Anchor Source</span>
                </div>
            </div>
        </div>

        <!-- Verify -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ” Verify Report Integrity</h3>
            <p class="panel-desc">Enter a date and root hash to check if it matches the on-chain/local record.</p>
            <div class="anchor-verify-row">
                <input type="date" class="input input-sm" id="anchorVerifyDate" />
                <input type="text" class="input" id="anchorVerifyHash" placeholder="Root hash (SHA-256 hex)" />
                <button class="btn btn-primary btn-sm" id="btnAnchorVerify">ğŸ” Verify</button>
            </div>
            <div class="anchor-verify-result hidden" id="anchorVerifyResult"></div>
        </div>

        <!-- Anchor History -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“œ Anchor History</h3>
            <div class="table-wrap">
                <table class="data-table" id="anchorTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Root Hash</th>
                            <th>Source</th>
                            <th>TX Digest</th>
                            <th>Anchored At</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Move Contract Info -->
        <div class="panel full-width">
            <h3 class="panel-title">ğŸ“ Smart Contract</h3>
            <p class="panel-desc">
                The Deepurge Anchor contract is a minimal Move module on Sui Testnet.
                It stores a <code>Table&lt;date, root_hash&gt;</code> and emits <code>AnchorEvent</code>s.
            </p>
            <details class="raw-toggle">
                <summary>View Move Contract Source</summary>
                <pre class="raw-json" id="moveContractSource">module deepurge_anchor::deepurge_anchor {
    use sui::event;
    use sui::table::{Self, Table};

    public struct Registry has key {
        id: UID,
        owner: address,
        entries: Table&lt;vector&lt;u8&gt;, vector&lt;u8&gt;&gt;,
        anchor_count: u64,
    }

    public struct AnchorEvent has copy, drop {
        date: vector&lt;u8&gt;,
        root_hash: vector&lt;u8&gt;,
        anchor_count: u64,
    }

    public entry fun anchor_report(
        registry: &amp;mut Registry,
        date: vector&lt;u8&gt;,
        root_hash: vector&lt;u8&gt;,
        ctx: &amp;mut TxContext,
    ) { ... }
}</pre>
            </details>
        </div>
    </section>

</main>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
